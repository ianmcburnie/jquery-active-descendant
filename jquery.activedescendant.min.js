
(function($,window,document,undefined){var pluginName='jquery-active-descendant';$.fn.activeDescendant=function activeDescendant(focusItem,descendantItems){return this.each(function onEach(){var $widget=$(this);var $focusItem=$widget.find(focusItem);var $descendantItems;var $descendantItemsContainer;$focusItem.commonKeyDown();function getDescendantItemsCommonAncestor(){return $descendantItems.first().parents().has($descendantItems.last()).first();}
function updateDom($activeDescendant,$newActiveDescendant){$focusItem.attr('aria-activedescendant',$newActiveDescendant.prop('id'));$activeDescendant.removeAttr('aria-selected');$newActiveDescendant.attr('aria-selected','true');$widget.trigger('activeDescendantChange',$newActiveDescendant);}
$widget.on('updateActiveDescendantCollection',function(e,collection){$descendantItems=$widget.find(collection);$descendantItems.nextId();$descendantItems.each(function(idx,itm){$(itm).data(pluginName,{'idx':idx});});if($descendantItemsContainer===undefined){$descendantItemsContainer=getDescendantItemsCommonAncestor();$descendantItemsContainer.nextId();$focusItem.attr('aria-owns',$descendantItemsContainer.prop('id'));}});$focusItem.on('blur',function(){$focusItem.removeAttr('aria-activedescendant');$widget.find('[aria-selected=true]').removeAttr('aria-selected');});$focusItem.on('downArrowKeyDown',function onDownArrowKeyDown(e){if($descendantItems.size()>0){var $activeDescendant=$widget.find('#'+$focusItem.attr('aria-activedescendant'));var $newActiveDescendant;if($activeDescendant.size()===0){$newActiveDescendant=$descendantItems.first();}else{var itemIdx=$activeDescendant.data(pluginName).idx;var $nextEl=$descendantItems.eq(itemIdx+1);var hasNextEl=$nextEl.length===1;var $firstEl=$descendantItems.eq(0);$newActiveDescendant=(hasNextEl)?$nextEl:$firstEl;}
updateDom($activeDescendant,$newActiveDescendant);}});$focusItem.on('upArrowKeyDown',function onUpArrowKeyDown(e){if($descendantItems.size()>0){var $activeDescendant=$widget.find('#'+$focusItem.attr('aria-activedescendant'));var $newActiveDescendant;if($activeDescendant.size()===0){$newActiveDescendant=$descendantItems.last();}else{var itemIdx=$activeDescendant.data(pluginName).idx;var $prevEl=$descendantItems.eq(itemIdx-1);var hasPrevEl=$prevEl.length===1;var $lastEl=$descendantItems.eq($descendantItems.length-1);$newActiveDescendant=(hasPrevEl)?$prevEl:$lastEl;}
updateDom($activeDescendant,$newActiveDescendant);}});if(descendantItems){$widget.trigger('updateActiveDescendantCollection',[descendantItems]);}});};}(jQuery,window,document));